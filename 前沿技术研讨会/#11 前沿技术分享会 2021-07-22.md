

# 11 前沿技术分享会 2021-07-22

# 主题

## 伦敦升级专题

# 时间

时间：2021/07/22  14:00

## 地点

私享

## 会议参加者：

曾汨、Raphina、Winky、姚翔

  

## 活动流程：

### 主题讨论
主题分享
分享一 伦敦升级各EIP介绍

分享二 GasToken兴亡史

分享三 难度炸弹考古

分享四 以太坊安全事件一览


## 摘要

### 伦敦升级各EIP介绍
曾汨老师为大家带来了伦敦升级各EIP介绍，分享了伦敦升级中的EIP和目的。

首先，曾汨介绍了以太坊升级的简史，包括DAO Fork、拜占庭升级、伊斯坦布尔、缪尔冰川等，以及伦敦升级选择这个时间的原因。

接着，曾汨介绍了伦敦升级包含的5个EIP：EIP-3554取代EIP-3238，将难度炸弹推迟到2021年12月1日，为了上海升级或合并做好准备；EIP-3540拒绝以0xEF字节码开头的新合约，主要为了服务于EIP-3540(EVM对象格式)，EVM对象格式的实施需要两次硬分叉，曾汨还介绍了部署流程：需要先拒绝特定起始字节的新合约，然后检查链上所有现有代码来选择前缀，未来，回来上海升级中通过EIP-3540引入容器格式和验证概念，最后在坎昆升级中引入新的扩展格式EOF2；EIP-1559是ETH1.0链手续费市场改革，引入了BaseFee机制，曾汨介绍了核心交易参数、用户交易体验，进行了钱包形态探讨等；接着，曾汨在讲两倍区块大小引发的状态问题后，指出EIP-3529降低Gas退款也是服务于EIP-1559，EIP-3529的引入可以限制利用返还机制进行以存储写入为重点的DoS攻击，也会导致GasToken失效；另外，EIP-3198添加操作码BASEFEE，使得EVM可以访问当前块内的BaseFee，为EIP-1559的配套提案。

最后，曾汨还介绍了伦敦升级流程和EIP-1559的意义以及客户端在当前的升级情况。

  

### GasToken兴亡史

原语里弄研究员Raphina分享了关于GasToken的研究成果。

Raphina首先介绍了GasToken出现的背景及条件，即为了鼓励开发者通过删除掉不需要的储存，保持良好的网络状态，以太坊机制中设计了两个负gas操作 —— SELFDESTRUCT及SSTORE，而如USDT等ERC-20 Token的设计中也确实一定程度上缓解了状态问题，但这一机制更多地被用在了GasToken上。Philip,Lorenz和Florian于2018年3月在IC3的Project Chicago的框架下发布了GasToken。

GasToken的发布目的之一是帮助使用者在gas价格波动的情况下节约gas费用，因为从原理上确实可以实现这一目的。基于SSTORE的GST1和基于SELFDESTRUCT的GST2都可实现这一目的，但因为GST2在价格波动率高的时候效率更高，因此在后来被使用更多。

Raphina谈到，GasToken在发布之初，就获得了很多讨论，Nick, Alex等人认为用户肯定会存垃圾信息进去，也有人表示这是利用了以太坊设计机制中薄弱的地方，主创成员也对此表示GasToken的另一个目的是推动资源模型对话。

而在实际使用方面来看，应用层面，1inch发布了更优化版的gastoken，Aave则在V2实现了对gastoken的原生支持，某种程度上减少了用户的交易成本；使用范围方面，根据Peter的说法，20年5月的时候，Gastoken合约占用了以太坊大约5%到10%的存储，2021年2月的时候，占用了大约四分之一到三分之一的存储空间。

因此，这样较大的影响范围也导致了一系列的问题：安全方面，Gas refund会加剧区块大小变化，放大网络存在的风险；对Gas费的影响方面，GasToken会和Gas费形成正反馈循环，不利于网络状态的健康；另外，GasToken还被某些用户大量用于薅羊毛。

社区对GasToken的态度也随着发展而有所改变，从EIP-3298提出移除，到EIP-3300提出线性移除，再到EIP-3403和最后的EIP-3529被纳入伦敦升级，GasToken自此退出舞台。

最后Raphina聊到了几个问题：一是Refund机制一开始提出的时候，是用于解决状态问题，但实际上并没有解决，那么在决策时，要进行何种程度的技术和经济评估，才能最大程度上保证有效;另外为什么GasToken发起团队一开始目的就是推动实现更好的机制，没有去提EIP，而是发布了GasToken?

  

### 难度炸弹考古

原语里弄研究员Winky分享了关于难度炸弹的研究报告。

首先，Winky介绍了难度炸弹的设计目的和原理，接着详细介绍了为了推迟难度炸弹爆炸而进行的几次分叉：

2017年10月，拜占庭升级

2017年1月ACD9，Vitalik提出注意难度炸弹，ACD19上讨论了EIP-649，包括回退三百万个区块以及降低出块奖励到3ETH，中国矿工在提案下方有反对声。后来经过ACD22，23，25讨论，定于10月17日进行分叉（但这天难度炸弹已经爆炸了）

2019年2月，君士坦丁堡升级

2018年7月ACD42，Vitalik提出注意难度炸弹，ACD43及ACD44对难度炸弹相关的多个提案进行了讨论，其中EIP-1240和EIP-1227均提议移除难度炸弹，但EIP-1240遭到所有人反对，EIP-1227中移除难度炸弹的提议讨论被规避掉，ACD45的讨论也没有形成结果，此后没有再集中讨论这些问题。

2019年12月 伊斯坦布尔&2020年1月缪尔冰川 EIP-2384（有提示，但James算错了无人发现）

2019年8月ACD69，Danno提出注意难度炸弹，ACD72上，James表示难度炸弹会在2020年4-7月爆炸被质疑后改称为3月，ACD73确定伊斯坦布尔不包括难度炸弹，ACD75James表示还在算，后来发现测算错了…之后Thomas帮忙测算，后来发生了缪尔冰川紧急硬分叉。

2021年8月，伦敦升级，EIP-3554

2020年11月ACD101，Danno提出注意难度炸弹，ACD104确认在7月爆炸，核心开发者artem vorotnikov提出拆难度炸弹，再次遭到强烈反对，ACD112上Alexey提议拆除难度炸弹，但未获得讨论。


接着Winky聊了几个核心问题：一是能否预测炸弹爆炸时间？实际上通过计算其实不难。二是难度炸弹给以太坊治理带来的问题：108次核心开发者会议中提到46次，11次硬分叉中又6次有难度炸弹EIP，没有一次无争议通过，关于时间、经济模型、拆弹等的整治很多，其实给社区带来了很高的治理成本。三是为什么不拆除难度炸弹：EIP-649,EIP-1227,EIP-1240,acd104（直接被否定）,112其实都提到过，但经济上的、意识形态上的原因使之最后都没有实现。

  

现场还对Alexey, Artem的观点和实际上不拆除难度炸弹的可能原因进行了讨论。

  

  

### 以太坊安全事件一览

