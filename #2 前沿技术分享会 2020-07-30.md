**

#2 前沿技术分享会 2020-07-30

## 主题

随机数与区块链 [https://docs.google.com/document/d/14NDPQCMzTUx1nKcDBaNkg3n2kYoRKPyrH7TkUGQNcuY/edit](https://docs.google.com/document/d/14NDPQCMzTUx1nKcDBaNkg3n2kYoRKPyrH7TkUGQNcuY/edit)

## 时间

时间：2020/07/30  14:00

## 地点

SNZ 

(Sponsored by SNZ) (Special thanks： Cobo Vault 赞助10枚无偏差骰子)

## 会议参加者：

**MYKEY**：姚翔；Magic 
**Circle**：曲明、潘明慧；
**链闻**：潘致雄；
**SNZ**：Neo、冯力全；
**DeBank**：hongbo；
**万向**：王琪、吴启迪、安鑫、朱冰心、潘晨； 
**ETHPlanet**：郭浩贇；
**Cobo**：刘力新；
**Fundamental Labs**：Yan Xin、樊绪新；
**IRISnet**：胡智威

## 活动流程

### 分享

1.[随机数概述](https://drive.google.com/file/d/1OxnUKTxxojXq18SV4YNA2y56HXe0F0f8/view?usp=sharing) 姚翔 20min

2.[Fair Dice随机数方案简介](https://github.com/DeBankDeFi/fairdicegame) DeBank 20min

3.[Iris 链上随机数方案简介](https://www.irisnet.org/docs/features/random.html) IRISnet 20min

4.随机数在STO中的应用前景 曲明 20min

讨论

1.随机数的应用场景

2.链外随机源的可行性分析

3.近期热点事件讨论

4.活动组织讨论

活动流程



#### 分享一：“随机数概述”—— 姚翔

姚翔首先分享了有关随机数的一般性知识。英文“随机”最早可以追溯到马蹄的杂乱无序的声音，而现代所指的随机主要是从统计学的角度中定义的，在计算机出现后，“随机”这个词的出现频率显著增加。随机数是在一个随机过程中选取的元素，具有以下特性：1、集合（结果是可预期的） 2、等概率 3、单次结果不可预测。简单来说就是掷一个骰子，我们知道会概率均等地产生1-6的一个数字，但不知道每一次具体的结果。

在工程应用中，一般很难应用真随机数，而是用到伪随机数。伪随机数就是根据确定性的算法计算出的一个符合随机性特征的序列。算法是否可靠？是否存在设计缺陷甚至暗藏后门？一般就需要进行随机性的检测，国际和国内常有的规范有如下几个：

─ NIST SP 800-90A

─ NIST SP 800-22

─ GB/T 32915-2016

─ GB/T 10111-2008

  
姚翔分享了NSA在Dual\_EC\_DRGB中植入潜在后门的故事，解释随机性检测的重要性。在随机数生成算法中如果存在“来历不明”的参数，要特别小心，同时足够的样本检测可以在一定程度上避免漏洞发挥作用。

随机数为什么重要呢？一个是安全，比如很多密码学原语都依赖随机数，包括私钥的产生，椭圆曲线签名中需要用到的k，都是依赖随机数。这都是性命相关的。2011年有hacker攻破PS3，就是因为索尼在椭圆曲线签名中使用了相同的k。参考：[https://www.bbc.com/news/technology-12116051](https://www.bbc.com/news/technology-12116051) 另一个维度是公平，包括彩票，随机抽查等，有其具体的现实意义，对工程的可行性要求更高，相对来说安全性假设可以稍弱。 

随机数产生的一般方法，比如通过从物理噪声中进行提取的自然方法，通过软件方法生成的方法。在区块链中，产生随机数的方法主要通过几种不同策略组合使用：一是多方协同生成；二是通过哈希函数等随机预言机引入随机性；三是通过承诺-揭示协议降低参与方作弊可能；四是引入门限协议或经济约束提高产生随机数的成功率。

  
#### 分享二：Fair Dice随机数方案简介—— DeBank hongbo

Fair Dice是一个在EOS上被广泛使用的随机数生成方案。方案的设计者Hongbo和大家分享了如何在区块链上给Fair Dice的用户“真实感”，同时对于项目方而言实现“安全性”。在区块链游戏中，每个用户单独下注与庄家进行对赌。其本质是用户和庄家在去中心化的以太坊/EOS智能合约平台上通过一系列协议来生成随机数。如果随机数落入用户下注的区间，则用户胜利，否则庄家胜利。

协议最初的设计是用户点击掷骰子，服务端（庄家）生成种子，种子经过哈希运算变成承诺，再把承诺上链，以上就完成了服务端的种子的承诺。这个时候可以确定的是种子和哈希是一一对应的，即后续庄家上传的种子是不会乱改的。在服务端完成上述动作后，用户端也要进行承诺，即用户端也要生成种子，哈希后上链，完成承诺。双方完成承诺后，再把用户的种子上传，此时需要验证用户的种子和哈希是否一一对应，这个时候服务端也需要上传自己的种子，完成验证后，两个种子进行掷骰子动作，生成随机数。但是以上方法hongbo的角度讲解来看，由于整个用户的操作过于复杂，上链操作比较多，实用性不好。上述具体的方法可参考以下流程图：([https://github.com/DeBankDeFi/fairdicegame](https://github.com/DeBankDeFi/fairdicegame))

![](https://lh3.googleusercontent.com/RTyTugQwOYFmOmjRZJ93bAN47S6JCcbjCDXexMT8Fw4Z8VOWcmDtJxyCL1uNuk5ea-kLLJzvFogUAA4G8b2szX5IaT8ZefBvAn2cKi9IalW49dN3_2Y32rYEg0t8C6hV5qlKeMeu)

所以为了提高用户的体验性，方案经过了优化：用户点击后，服务端生成种子和其对应的哈希，以及对哈希的签名，其中哈希和哈希的签名回传给用户，用户直接上传自己的种子和服务端的哈希签名，最后等服务端上传种子，即可算出随机数。其中为了确保用户不会替换掉服务端的哈希，需要庄家进行其进行签名，然后链上检查签名。

![](https://lh6.googleusercontent.com/8LS0objue4QC58nw35QSLZ715kFoJcBvX80q5hLKc1QLCBFEN7xjsl7RsnaVF0gTfCkyoLJJEFGs9x9xRg-FIxLl7DsfYgtLbZuxp4Lk48484A7sp3b4z4UVIWyV0k222OMXfRgJ)

Hongbo分享说在实际应用中，很多项目方在复用这个方案时，由于对于很多逻辑的不了解，擅自对协议的参数或流程进行修改，导致协议被攻击，造成了极大的经济损失。同时，该方案存在内部人员监守自盗，进行攻击的风险。

**Q&A**: 

**Q:对于客户端来说上链哈希和种子的时候是否需要签名？**

A:上链本身就是需要通过私钥进行签名的。

  

**Q:通过理论上方法进行随机数产生的过程来说，不过完美是由于用户的体验吗？但是对于用户来说，他就是进行点击没有其他操作的？（为什么说之前的方案实际使用不够友好）**

A:确实是，但是在实际操作过程中用户需要在种子上链之后，用户才能够进行下一步，会产生用户等待的时间，接下来用户还需要将产生的种子和哈希进行上链操作，之后又是等待。

  

**Q:如果用户提前进行哈希和种子和服务端的哈希和种子同时进行呢？**

A:理论上是可以的，但是这样做就不能保证该随机数的真实性。

  

**Q:所有的服务都是需要中间的一个house的中间商？**

A:是的，假如没有的话就不能保证安全性。

  

**Q:在优化方案中是否会产生签名的重复问题？**

A:为了防止签名的重放，在签名的内容中包含了超时的信息，可以认为是一个自增的时间戳数据，如果带着之前的信息签名的话是不能通过校验的。


#### 分享三：IRISnet 链上随机数方案简介——IRISnet 胡智威

IRISnet 研究总监胡智威介绍了目前IRIS公链的随机数生成方案。

现在有两种随机数生成方案，一种是链上随机数方案也是目前在主网上实施的，另一种就是引入链外的随机数方案，就是把链上的随机数和链外oracle综合的随机数方案。这次分享主要介绍了前一种。

IRISnet目前的随机数生成器主要通过区块链生成的多个指标作为“种子”来计算随机数，增加随机性，同时也使得此随机数公开透明，方便验证。随机数“种子”有：上一个区块的哈希，哈希本身就具有一定的不可预测性；当前区块的时间戳：区块时间戳采用 BFT 时间，即根据验证人的权重计算出中位数，这样计算出来的分布式时间戳，也具有一定的不可预测性；发起随机数请求的链上地址，是希望每个账户产生的随机数是不同的。

链上随机数从攻击的成本和获得收益的比率来看是不合算的，因为需要攻击公链的共识，这需要非常高的成本。

关于参数的选取，hongbo认为应当尽量减少参数的个数，避免协议被操控的可能。

姚翔认为选择中位数时间可能造成协议被操纵。

胡智威表示，目前该方案仍在完善阶段，感谢大家的建议，团队也会研究这些问题。

  

#### 分享四：随机数在STO中的应用前景——Magic Circle 曲明

曲总和大家分享了随机数在数字证券领域中的相关应用，他首先和大家分享了关于数字证券领域中现在遇到的一些技术问题，比如如何通过Token的方式表达现实世界中证券所带变的权益，比如是否有分红的权益，优先股，是否受限等，同时如何在STO的过程中符合监管要求，实现合规发行，同时还有基于Captable的管理和发行机制，海外现在针对Captable的SaaS服务已经很成熟，但是中国的企业只有在IPO之前可能才会涉及到自己公司的Captable管理的问题，但是在数字证券的发行之初就会遇到这些问题，如何通过链上技术实现数字证券的Captable自动化管理也是现在遇到的技术难题。

从2020年的实际情况来看数字证券的发展势头是非常迅猛的，流动市值从6月3日突破1亿美金，到7月20日突破3亿美元，最近的Republic Note在5天的token sale融资1000万美金，预计将超过1600万美金。同时美国SEC在今年3月的最新法案中也提出提高融资上限和放宽合格投资人规定，同时Magic Circle也看到STO和DeFi的融合。数字证券可以看成是DeFi天然的最好的底层资产，主要体现在两部分，首先，ST本身作为证券的属性具有担保抵押的功能；第二，DeFi现在接受的资产是同质化代币，但是ST是有资产背书的，属于非同质化代币，这样作为DeFi底层资产后会天然的扩大DeFi的可扩展性。

那么随机数在STO过程的应用曲总认为主要可以体现在打新销售的过程中，传统的ICO的时候时进行Token售卖的时候主要通过早鸟价等完成，但是某研究机构的论文表明，早鸟价打折价格和募资总额并没有完全的相关性，假如引入随机数的概念后，投资人可以通过产生的随机数获得打折或者高于一般价格获得数字证券，希望通过这样的方式促进数字证券的发行，刺激投资人的购买欲。所以这个时候如何产生让全网认可的公平的随机数就是需要解决的问题了。

所以曲总也发出了关于随机数产生相关的问题，比如真随机数如何产生，如何证明可信性，是否具有时间性和实时性，如果产生攻击的话成本如何？现存的法律机制是否有仲裁机制等？

曲总希望和大家共同探讨出这些问题的结果。


####  延伸阅读

链外和Oracle进行互联产生随机数？？

参考：[https://medium.com/moac/implementation-of-practical-decentralized-blockchain-random-numbers-d73d5275a5fc](https://medium.com/moac/implementation-of-practical-decentralized-blockchain-random-numbers-d73d5275a5fc)

 
**一、让可信第三方为合约提供随机数**

![](https://lh3.googleusercontent.com/Oj_l_a6ZVW6jNN-dpQ_YUVN3TSXlURI-z81BDahx7KX4deMeixcZFZAU8h8-gX6wSDVlqU_tGz50_XYUpcnADa7LdycqPlRBoE_mrZsUuWQBdQPGm1l8hFdnGYdW_wYRw7KgKqph)

第一种是让可信第三方为合约提供随机数，这种情况通常是中心化的解决方案，通过一个可信的 Oracle 来提供独立的随机数源。智能合约发送请求给独立于区块链系统之外的Oracle，当 Oracle 监听到链上相关请求后，生成随机数并调用回调函数将结果返回区块链。参考：[https://www.random.org/](https://www.random.org/)

  

**二、更加中心化的可信第三方**

这个方式是在方法一的基础上，配合通过多方提供随机数源，然后统一由第三方进行链上聚合，聚合后得到的随机数回调给随机数使用方。目前chainlink是这种模式。

  

**三、交互式的 commit 和 reveal**

和Debank的方案类似：

第二种是交互式的 commit 和 reveal。参与过程的多方预先 commit 一个随机数，然后将 hash 递交到区块链上。所有参与方都递交完毕后，各方 reveal 自己的随机数，通过将各自的随机数合并产生一个最终的随机数。这个过程能够保证随机数不被预先知道。但是需要一些质押等博弈论手段来防止有人拒绝reveal。

![](https://lh4.googleusercontent.com/4zOb3dWPcAvDcPlGlF5VVlWYjzo0x3oThKY7yrCLA1N0uY5RKEaEEiO_8tQ4xpXex81qchTQT4REvYuLIHhtPudxlyrcJdlN5qTkKu_yqsdG1Ha6MPNMWZZMgLo-MNLYPnodB8IY)

**四、门限签名（可能需要补充）**

第四种是从共识层，通过门限签名的方式，使得每个共识节点递交各自对某个信息的签名片段，在足够多的签名片段收集到之后，任何一个共识节点都可以将签名片段合并成一个合法的可验证的签名。这个签名可以作为随机数源。

![](https://lh4.googleusercontent.com/wE3hWpaFSRLAYQAKABGNjGOZyDjdLZkbnPVJ3B8kwGOIWR_JfSLEkUMDNTzNJK5GUtMHCVdZ6dAgVhn4MuOinRMZHdUGvLpEC829ipBbpS0wlODF27l5cIuTZ2MwAk3Zm1Qw-R74)

 